<?xml version="1.0" encoding="UTF-8"?>
<!-- edited with XMLSPY v5 rel. 2 U (http://www.xmlspy.com) by 123 (456) -->
#set($environment = $environment)
#set($models = $protoDom.getModelDoms())
#set($baseParams = $protoDom.getBaseParamDoms())
#set($controllers = $protoDom.getControllerDoms())
#set($marcoFiles = $protoDom.getMarcoFileDoms())
#set($controller_package = $environment.controller_package)
#set($model_package = $environment.model_package)
#set($marcos_package = $environment.marcos_package)
#set($params_package = $environment.params_package)

#set($service_name = $protoDom.file_name)
<proto>
#foreach($controller in $controllers)
    <file name="${tool.getPath($controller_package)}${controller.name}ConsumerTemplate.java">
        <![CDATA[
${environment.notes}
package ${controller_package};
import ${model_package}.*;
import ${params_package}.*;
import java.util.List;
import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.stereotype.Component;
import org.springframework.beans.factory.annotation.Autowired;
import com.rabbitmq.client.Channel;
import org.springframework.amqp.core.Message;
import java.io.IOException;

@Component
public class ${controller.name}ConsumerTemplate {
    @Autowired
    public ${controller.name}ConsumerHandler m${controller.name}ConsumerHandler;
#foreach($method in ${controller.methodDoms})
    @RabbitListener(queues = "${method.url}")
    public void ${method.name}(${controller.name}${tool.toUpperCaseFirstOne($method.name)}Params m${controller.name}${tool.toUpperCaseFirstOne($method.name)}Params, Channel channel, Message message) {
        try {
            m${controller.name}ConsumerHandler.${method.name}(m${controller.name}${tool.toUpperCaseFirstOne($method.name)}Params);
            ackMessage(true, channel, message);
        } catch (Exception e) {
            ackMessage(false, channel, message);
        }
    }
#end
    /**
     * ack
     * @param success
     * @param channel
     * @param message
     */
    public void ackMessage(boolean success, Channel channel, Message message) {
        try {
            if (success) {
                channel.basicAck(message.getMessageProperties().getDeliveryTag(), false);
            } else {
                channel.basicNack(message.getMessageProperties().getDeliveryTag(), false, true);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
        ]]>
    </file>
    <file name="${tool.getPath($controller_package)}${controller.name}ConsumerHandler.java">
        <![CDATA[
${environment.notes}
package ${controller_package};
import ${model_package}.*;
import ${params_package}.*;
import java.util.List;

public interface ${controller.name}ConsumerHandler {
#foreach($method in ${controller.methodDoms})
    void ${method.name}(${controller.name}${tool.toUpperCaseFirstOne($method.name)}Params m${controller.name}${tool.toUpperCaseFirstOne($method.name)}Params);
#end
        }
        ]]>
    </file>
    <file name="${tool.getPath($controller_package)}${controller.name}ProducerHandler.java">
        <![CDATA[
${environment.notes}
package ${controller_package};
import ${model_package}.*;
import ${params_package}.*;
import java.util.List;
import org.springframework.amqp.core.AmqpTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

@Component
public class ${controller.name}ProducerHandler {
    @Autowired
    private AmqpTemplate amqpTemplate;
#foreach($method in ${controller.methodDoms})
    /**
     * ${method.des}
     */
    public void ${method.name}(${controller.name}${tool.toUpperCaseFirstOne($method.name)}Params m${controller.name}${tool.toUpperCaseFirstOne($method.name)}Params) {
        amqpTemplate.convertAndSend("${method.url}", m${controller.name}${tool.toUpperCaseFirstOne($method.name)}Params);
    }
#end
}
        ]]>
    </file>
#end

    <file name="${tool.getPath($params_package)}base/BaseParams.java">
        <![CDATA[
package ${params_package}.base;
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import ${model_package}.*;
import lombok.Data;
        import java.io.Serializable;
@Data
@ApiModel
public class BaseParams implements Serializable{
#foreach($methodParameterDom in ${baseParams})
    @ApiModelProperty("${methodParameterDom.des}")
    private $tool.typeChange(${methodParameterDom.type}) ${methodParameterDom.name};
#end
}
        ]]>
    </file>

#foreach($controller in $controllers)
#foreach($method in ${controller.methodDoms})
    <file name="${tool.getPath($params_package)}${controller.name}${tool.toUpperCaseFirstOne($method.name)}Params.java">
        <![CDATA[
package ${params_package};
import ${params_package}.base.BaseParams;
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;
import ${model_package}.*;
@Data
@AllArgsConstructor
@NoArgsConstructor
@ApiModel
public class ${controller.name}${tool.toUpperCaseFirstOne($method.name)}Params extends BaseParams {
#foreach($methodParameterDom in ${method.methodParameterDoms})
    @ApiModelProperty("${methodParameterDom.des}")
    private $tool.typeChange(${methodParameterDom.type}) ${methodParameterDom.name};
#end
}
        ]]>
    </file>
#end
#end
</proto>